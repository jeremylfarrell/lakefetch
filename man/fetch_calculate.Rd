% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fetch_core.R
\name{fetch_calculate}
\alias{fetch_calculate}
\title{Calculate Fetch for Lake Sampling Sites}
\usage{
fetch_calculate(
  sites,
  lake,
  depth_m = NULL,
  fetch_method = NULL,
  add_context = TRUE,
  find_max_fetch = FALSE
)
}
\arguments{
\item{sites}{Data frame or sf object with site locations}

\item{lake}{Lake boundary data from \code{\link{get_lake_boundary}}}

\item{depth_m}{Water depth in meters for orbital velocity calculation.
Can be a single value (applied to all sites), a vector (one per site),
or NULL to use depth from sites data or default from options.}

\item{fetch_method}{Method for calculating effective fetch. Options:
\describe{
\item{"top3"}{Mean of the 3 highest directional fetch values (default)}
\item{"max"}{Maximum directional fetch value}
\item{"cosine"}{SPM/CERC cosine-weighted average. Uses 9 radials centered
on the direction of maximum fetch at 6-degree intervals, weighted by
cosine of angle from center. Based on Shore Protection Manual (1984).}
}
If NULL, uses the value from \code{\link{lakefetch_options}}.}

\item{add_context}{Logical; add NHD context if available (default TRUE)}

\item{find_max_fetch}{Logical; if TRUE, finds the location in each lake with
the maximum possible fetch using a longest-internal-chord algorithm. The
result is returned as a \code{$max_fetch} element in the output list.
Default FALSE.}
}
\value{
A list with elements:
\item{results}{sf object with fetch results for each site}
\item{lakes}{sf object with lake polygons used}
\item{angles}{Vector of angles used for fetch calculation}
\item{max_fetch}{(only if \code{find_max_fetch = TRUE}) sf object with one
row per lake containing the maximum fetch location, chord length (meters),
and chord bearing (degrees)}
}
\description{
Main entry point for fetch calculation. Takes sites and lake boundaries,
calculates directional fetch using ray-casting, and returns results with
exposure metrics.
}
\details{
For each site, the function:
\enumerate{
\item Assigns the site to its containing lake polygon
\item Buffers the site inward from shore (GPS accuracy adjustment)
\item Casts rays in all directions at specified angle resolution
\item Measures distance to shore in each direction
\item Calculates summary metrics (mean, max, effective fetch)
\item Calculates orbital velocity using depth
\item Derives exposure category (Sheltered/Moderate/Exposed)
}

Exposure thresholds can be configured via \code{\link{lakefetch_options}}.
}
\examples{
if (FALSE) {
sites <- load_sites("my_sites.csv")
lake <- get_lake_boundary(sites)
results <- fetch_calculate(sites, lake)

# With explicit depth
results <- fetch_calculate(sites, lake, depth_m = 5)

# Using cosine-weighted effective fetch (SPM method)
results <- fetch_calculate(sites, lake, fetch_method = "cosine")

# Access results
results$results  # sf with all fetch data
results$lakes    # lake polygons

# Find the location with maximum fetch in each lake
results <- fetch_calculate(sites, lake, find_max_fetch = TRUE)
results$max_fetch  # sf with max fetch location per lake
}

}
\references{
Shore Protection Manual (1984). U.S. Army Corps of Engineers, Coastal
Engineering Research Center. 4th Edition.
}
